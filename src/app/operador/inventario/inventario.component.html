<div class="p-4 sm:p-6 max-w-full sm:max-w-5xl mx-auto">
  <h1 class="text-2xl sm:text-3xl font-bold mb-4 sm:mb-6" style="color: var(--color-foreground)">Inventario de Medicamentos</h1>

  <!-- Buscador -->
  <div class="mb-4 flex flex-col sm:flex-row gap-3">
    <input
      type="text"
      [(ngModel)]="searchText"
      placeholder="Buscar medicamento o presentación..."
      class="flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"
      style="border-color: var(--color-secondary); background-color: var(--color-bg)"
    />
  </div>

  <!-- Botón y formulario para agregar medicamento -->
  <div class="mb-6">
    <button (click)="mostrarFormulario = !mostrarFormulario"
      class="px-4 py-2 rounded-lg font-medium mb-2"
      style="background-color: var(--color-accent); color: white">
      {{ mostrarFormulario ? 'Cancelar' : 'Agregar Medicamento' }}
    </button>
    <form *ngIf="mostrarFormulario" (ngSubmit)="agregarMedicamento()" class="grid grid-cols-1 sm:grid-cols-4 gap-3 items-end">
      <div>
        <label class="block text-xs font-medium mb-1" style="color: var(--color-foreground)">Nombre</label>
        <input type="text" [(ngModel)]="nuevoMedicamento.nombre" name="nombre" required
          class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"
          style="border-color: var(--color-secondary); background-color: var(--color-bg)" />
      </div>
      <div>
        <label class="block text-xs font-medium mb-1" style="color: var(--color-foreground)">Presentación</label>
        <input type="text" [(ngModel)]="nuevoMedicamento.presentacion" name="presentacion" required
          class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"
          style="border-color: var(--color-secondary); background-color: var(--color-bg)" />
      </div>
      <div>
        <label class="block text-xs font-medium mb-1" style="color: var(--color-foreground)">Cantidad</label>
        <input type="number" [(ngModel)]="nuevoMedicamento.cantidad" name="cantidad" min="0" required
          class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"
          style="border-color: var(--color-secondary); background-color: var(--color-bg)" />
      </div>
      <div>
        <label class="block text-xs font-medium mb-1" style="color: var(--color-foreground)">Stock mínimo</label>
        <input type="number" [(ngModel)]="nuevoMedicamento.minimo" name="minimo" min="0" required
          class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2"
          style="border-color: var(--color-secondary); background-color: var(--color-bg)" />
      </div>
      <div class="sm:col-span-4 flex justify-end mt-2">
        <button type="submit"
          class="px-4 py-2 rounded-lg font-medium"
          style="background-color: var(--color-primary); color: white">
          Guardar
        </button>
      </div>
    </form>
  </div>

  <!-- Vista tarjetas en móvil -->
  <div class="sm:hidden">
    <div *ngFor="let m of medicamentosFiltrados" class="mb-4 bg-white rounded-lg shadow-md border p-4" style="border-color: var(--color-secondary)">
      <div class="flex justify-between items-center mb-2">
        <div>
          <h2 class="font-semibold text-lg" style="color: var(--color-primary)">{{ m.nombre }}</h2>
          <p class="text-xs" style="color: var(--color-foreground)">{{ m.presentacion }}</p>
        </div>
        <span *ngIf="estadoStock(m) === 'ok'" class="inline-block px-2 py-1 rounded text-xs font-medium" style="background-color: var(--color-accent); color: white">Suficiente</span>
        <span *ngIf="estadoStock(m) === 'bajo'" class="inline-block px-2 py-1 rounded text-xs font-medium" style="background-color: #F59E42; color: white">Bajo stock</span>
        <span *ngIf="estadoStock(m) === 'critico'" class="inline-block px-2 py-1 rounded text-xs font-medium" style="background-color: #EF4444; color: white">Sin stock</span>
      </div>
      <div class="mb-2">
        <span class="font-medium">Cantidad:</span>
        <ng-container *ngIf="editandoId !== m.id; else editCantidadMobile">
          {{ m.cantidad }}
        </ng-container>
        <ng-template #editCantidadMobile>
          <input type="number" [(ngModel)]="cantidadEditada" min="0"
            class="w-20 px-2 py-1 border rounded focus:outline-none"
            style="border-color: var(--color-secondary); background-color: var(--color-bg)" />
        </ng-template>
      </div>
      <div>
        <ng-container *ngIf="editandoId !== m.id; else accionesEdicionMobile">
          <button (click)="iniciarEdicion(m)" class="px-3 py-1 rounded text-xs font-medium hover:opacity-80 mr-2" style="background-color: var(--color-primary); color: white">Editar</button>
        </ng-container>
        <ng-template #accionesEdicionMobile>
          <button (click)="guardarEdicion(m)" class="px-3 py-1 rounded text-xs font-medium mr-2" style="background-color: var(--color-accent); color: white">Guardar</button>
          <button (click)="cancelarEdicion()" class="px-3 py-1 rounded text-xs font-medium" style="background-color: var(--color-secondary); color: var(--color-foreground)">Cancelar</button>
        </ng-template>
      </div>
    </div>
    <div *ngIf="medicamentosFiltrados.length === 0" class="p-8 text-center" style="color: var(--color-foreground); opacity: 0.6">
      No hay medicamentos en el inventario
    </div>
  </div>

  <!-- Tabla en pantallas grandes -->
  <div class="hidden sm:block bg-white rounded-lg shadow-md border" style="border-color: var(--color-secondary)">
    <div class="overflow-x-auto">
      <table class="min-w-[600px] w-full text-xs sm:text-sm">
        <thead>
          <tr class="border-b" style="background-color: var(--color-bg); border-color: var(--color-secondary)">
            <th class="px-2 sm:px-4 py-2 sm:py-3 text-left font-semibold" style="color: var(--color-foreground)">Medicamento</th>
            <th class="px-2 sm:px-4 py-2 sm:py-3 text-left font-semibold" style="color: var(--color-foreground)">Presentación</th>
            <th class="px-2 sm:px-4 py-2 sm:py-3 text-left font-semibold" style="color: var(--color-foreground)">Cantidad</th>
            <th class="px-2 sm:px-4 py-2 sm:py-3 text-left font-semibold" style="color: var(--color-foreground)">Estado</th>
            <th class="px-2 sm:px-4 py-2 sm:py-3 text-left font-semibold" style="color: var(--color-foreground)">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let m of medicamentosFiltrados" class="border-b" style="border-color: var(--color-secondary)">
            <td class="px-2 sm:px-4 py-2 sm:py-3" style="color: var(--color-foreground)">{{ m.nombre }}</td>
            <td class="px-2 sm:px-4 py-2 sm:py-3" style="color: var(--color-foreground)">{{ m.presentacion }}</td>
            <td class="px-2 sm:px-4 py-2 sm:py-3" style="color: var(--color-foreground)">
              <ng-container *ngIf="editandoId !== m.id; else editCantidad">
                {{ m.cantidad }}
              </ng-container>
              <ng-template #editCantidad>
                <input type="number" [(ngModel)]="cantidadEditada" min="0"
                  class="w-16 sm:w-20 px-2 py-1 border rounded focus:outline-none"
                  style="border-color: var(--color-secondary); background-color: var(--color-bg)" />
              </ng-template>
            </td>
            <td class="px-2 sm:px-4 py-2 sm:py-3">
              <span *ngIf="estadoStock(m) === 'ok'" class="inline-block px-2 py-1 rounded text-xs font-medium" style="background-color: var(--color-accent); color: white">Suficiente</span>
              <span *ngIf="estadoStock(m) === 'bajo'" class="inline-block px-2 py-1 rounded text-xs font-medium" style="background-color: #F59E42; color: white">Bajo stock</span>
              <span *ngIf="estadoStock(m) === 'critico'" class="inline-block px-2 py-1 rounded text-xs font-medium" style="background-color: #EF4444; color: white">Sin stock</span>
            </td>
            <td class="px-2 sm:px-4 py-2 sm:py-3">
              <ng-container *ngIf="editandoId !== m.id; else accionesEdicion">
                <button (click)="iniciarEdicion(m)" class="px-2 sm:px-3 py-1 rounded text-xs font-medium hover:opacity-80" style="background-color: var(--color-primary); color: white">Editar</button>
              </ng-container>
              <ng-template #accionesEdicion>
                <button (click)="guardarEdicion(m)" class="px-2 sm:px-3 py-1 rounded text-xs font-medium mr-2" style="background-color: var(--color-accent); color: white">Guardar</button>
                <button (click)="cancelarEdicion()" class="px-2 sm:px-3 py-1 rounded text-xs font-medium" style="background-color: var(--color-secondary); color: var(--color-foreground)">Cancelar</button>
              </ng-template>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div *ngIf="medicamentosFiltrados.length === 0" class="p-8 text-center" style="color: var(--color-foreground); opacity: 0.6">
      No hay medicamentos en el inventario
    </div>
  </div>
</div>
